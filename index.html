<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Daily Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* 隐藏滚动条但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-white text-gray-900 antialiased">

    <div class="flex h-screen overflow-hidden">
        <div class="absolute top-4 right-8 z-10 flex items-center bg-white/80 backdrop-blur-md px-4 py-2 rounded-full border border-gray-100 shadow-sm">
    <span class="text-xs text-gray-400 mr-2 uppercase tracking-widest">Date</span>
    <input type="date" id="datePicker" 
        class="text-sm font-medium text-gray-700 bg-transparent focus:outline-none cursor-pointer">
</div>
        
        <aside class="w-[30%] border-r border-gray-100 flex flex-col h-full bg-gray-50/50">
            <div class="p-8">
                <h2 class="text-sm font-medium tracking-widest uppercase text-gray-400 mb-8">Tasks</h2>
                
                <div class="relative mb-6">
                    <input type="text" id="taskInput" 
                        class="w-full bg-transparent border-b border-gray-200 py-2 focus:outline-none focus:border-gray-900 transition-colors placeholder-gray-300" 
                        placeholder="添加新任务...">
                </div>

                <ul id="taskList" class="space-y-4 overflow-y-auto no-scrollbar max-h-[calc(100vh-200px)]">
                    <li class="flex items-center group">
                        <div class="w-4 h-4 border border-gray-300 rounded-sm mr-3 group-hover:border-gray-900 cursor-pointer transition-colors"></div>
                        <span class="text-sm text-gray-600">整理今日会议要点</span>
                    </li>
                </ul>
            </div>
            <div class="mt-auto p-8 border-t border-gray-100">
    <div class="flex items-center justify-between text-[10px] tracking-widest uppercase text-gray-400">
        <button onclick="exportData()" class="hover:text-gray-900 transition-colors">Export JSON</button>
        <label class="cursor-pointer hover:text-gray-900 transition-colors">
            Import JSON
            <input type="file" id="importInput" class="hidden" accept=".json">
        </label>
    </div>
</div>
        </aside>

        <main class="w-[70%] flex flex-col h-full">
            <div class="p-8 flex flex-col h-full">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-sm font-medium tracking-widest uppercase text-gray-400">Meeting Minutes</h2>
                    <span id="saveStatus" class="text-[10px] text-gray-300 italic uppercase">Auto-saving...</span>
                </div>
                
                <textarea id="meetingNotes" 
                    class="flex-1 w-full resize-none bg-transparent text-lg leading-relaxed text-gray-700 focus:outline-none placeholder-gray-200" 
                    placeholder="在此开始记录..."
                ></textarea>
            </div>
        </main>

    </div>
    <script>
        // --- 1. 状态初始化 ---
        // --- 1. 状态管理升级 ---
let currentDate = new Array(); // 占位
const datePicker = document.getElementById('datePicker');

// 获取当前选中的日期字符串 (YYYY-MM-DD)
const getDS = () => datePicker.value;

let state = {
    tasks: [],
    notes: ""
};
    // --- 2. DOM 元素获取 ---
    const taskInput = document.getElementById('taskInput');
    const taskList = document.getElementById('taskList');
    const notesArea = document.getElementById('meetingNotes');
    const saveStatus = document.getElementById('saveStatus');

    // --- 3. 核心功能函数 ---

    // 渲染任务列表
    const renderTasks = () => {
        taskList.innerHTML = state.tasks.map((task, index) => `
            <li class="flex items-center group animate-in fade-in duration-300">
                <div onclick="removeTask(${index})" 
                    class="w-4 h-4 border border-gray-300 rounded-sm mr-3 group-hover:border-red-400 group-hover:bg-red-50 cursor-pointer transition-all">
                </div>
                <span class="text-sm text-gray-600">${task}</span>
            </li>
        `).join('');
        localStorage.setItem('min_tasks', JSON.stringify(state.tasks));
    };

    // 添加任务
    const addTask = (content) => {
        if (!content.trim()) return;
        state.tasks.push(content.trim());
        taskInput.value = '';
        renderTasks();
        saveDataByDate();
    };

    // 删除任务
    const removeTask = (index) => {
        state.tasks.splice(index, 1);
        renderTasks();
        saveDataByDate();
    };

    // 保存笔记 (带状态提示)
    // --- 2. 核心：基于日期的加载与保存 ---

const loadDataByDate = () => {
    const ds = getDS();
    state.tasks = JSON.parse(localStorage.getItem(`min_tasks_${ds}`)) || [];
    state.notes = localStorage.getItem(`min_notes_${ds}`) || "";
    
    // 同步 UI
    notesArea.value = state.notes;
    renderTasks();
};

const saveDataByDate = () => {
    const ds = getDS();
    localStorage.setItem(`min_tasks_${ds}`, JSON.stringify(state.tasks));
    localStorage.setItem(`min_notes_${ds}`, state.notes);
    
    saveStatus.innerText = "Saved to " + ds;
    setTimeout(() => { saveStatus.innerText = "Auto-saving..."; }, 2000);
};

// --- 3. 增强后的 saveNotes (整合任务提取) ---
const saveNotes = () => {
    state.notes = notesArea.value;
    
    // 正则提取逻辑 (保持不变)
    const taskRegex = /^- \[ \] (.+)$/gm;
    let match;
    let hasNewTask = false;

    while ((match = taskRegex.exec(state.notes)) !== null) {
        const newTaskContent = match[1].trim();
        if (newTaskContent && !state.tasks.includes(newTaskContent)) {
            state.tasks.push(newTaskContent);
            hasNewTask = true;
        }
    }


    // 3. 数据持久化
    localStorage.setItem('min_notes', state.notes);
    
    // 4. 视觉反馈：如果提取了新任务，则刷新列表并保存
    saveDataByDate();
    if (hasNewTask) {
        renderTasks();
        localStorage.setItem('min_tasks', JSON.stringify(state.tasks));
    }

    // 更新状态提示
    saveStatus.innerText = "Saved & Synced";
    setTimeout(() => { saveStatus.innerText = "Auto-saving..."; }, 2000);
};


// 建议同步更新 CSS：为新添加的任务增加一个简单的闪烁动画
const style = document.createElement('style');
style.innerHTML = `
    @keyframes highlight {
        0% { background-color: transparent; }
        50% { background-color: #fef08a; } /* 浅黄色 */
        100% { background-color: transparent; }
    }
    .animate-new-task { animation: highlight 2s ease-out; }
`;
document.head.appendChild(style);

    // --- 4. 防抖逻辑 (Debounce) ---
    const debounce = (fn, delay) => {
        let timer;
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), delay);
        };
    };

    const debouncedSave = debounce(saveNotes, 500);

    // --- 5. 事件监听 ---

    // 任务输入框回车
    taskInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addTask(e.target.value);
    });

    // 笔记输入监听
    notesArea.addEventListener('input', () => {
        saveStatus.innerText = "Typing...";
        debouncedSave();
    });

    // --- 6. 页面加载初始化 ---
    window.addEventListener('DOMContentLoaded', () => {
        notesArea.value = state.notes;
        renderTasks();
    });
    // --- 事件监听升级 ---
    // 日期切换监听
datePicker.addEventListener('change', () => {
    // 切换前可以先执行一次保存，防止数据丢失
    saveDataByDate(); 
    loadDataByDate();
});

// 初始化日期选择器为今天
window.addEventListener('DOMContentLoaded', () => {
    const today = new Date().toISOString().split('T')[0];
    datePicker.value = today;
    loadDataByDate();
});
        // --- 数据备份与还原功能 ---

// 1. 导出函数：打包所有以 "min_" 开头的本地数据
const exportData = () => {
    const backupData = {};
    // 遍历所有数据，只抓取我们应用产生的 key
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('min_')) {
            backupData[key] = localStorage.getItem(key);
        }
    }

    const dataStr = JSON.stringify(backupData, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    
    // 创建虚拟链接并触发下载
    const link = document.createElement("a");
    link.href = url;
    link.download = `sync_backup_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
};

// 2. 导入函数：读取 JSON 并存入 LocalStorage
document.getElementById('importInput').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
        try {
            const importedData = JSON.parse(event.target.result);
            
            // 确认覆盖提示
            if (confirm("导入将合并数据，是否继续？")) {
                Object.keys(importedData).forEach(key => {
                    if (key.startsWith('min_')) {
                        localStorage.setItem(key, importedData[key]);
                    }
                });
                alert("导入成功！页面即将刷新。");
                location.reload(); // 刷新以加载新数据
            }
        } catch (err) {
            alert("文件格式错误，请确保是有效的 JSON 文件。");
        }
    };
    reader.readAsText(file);
});
    </script>     
</body>

</html>
