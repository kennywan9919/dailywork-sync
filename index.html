<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Daily Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-white text-gray-900 antialiased">

    <div class="flex h-screen overflow-hidden">
        <div class="absolute top-20 right-4 z-10 flex items-center bg-white/80 backdrop-blur-md px-4 py-2 rounded-full border border-gray-100 shadow-sm">
    <span class="text-xs text-gray-400 mr-2 uppercase tracking-widest">Date</span>
    <input type="date" id="datePicker" 
        class="text-sm font-medium text-gray-700 bg-transparent focus:outline-none cursor-pointer">
</div>
        
        <aside class="w-[30%] border-r border-gray-100 flex flex-col h-full bg-gray-50/50">
            <div class="p-8">
                <h2 class="text-sm font-medium tracking-widest uppercase text-gray-400 mb-8">Tasks</h2>
                
                <div class="relative mb-6">
                    <input type="text" id="taskInput" 
                        class="w-full bg-transparent border-b border-gray-200 py-2 focus:outline-none focus:border-gray-900 transition-colors placeholder-gray-300" 
                        placeholder="æ·»åŠ æ–°ä»»åŠ¡...">
                </div>

                <ul id="taskList" class="space-y-4 overflow-y-auto no-scrollbar max-h-[calc(100vh-200px)]">
                    <li class="flex items-center group">
                        <div class="w-4 h-4 border border-gray-300 rounded-sm mr-3 group-hover:border-gray-900 cursor-pointer transition-colors"></div>
                        <span class="text-sm text-gray-600">æ•´ç†ä»Šæ—¥ä¼šè®®è¦ç‚¹</span>
                    </li>
                </ul>
            </div>
            <div class="mt-auto p-8 border-t border-gray-100">
    <div class="flex items-center justify-between text-[10px] tracking-widest uppercase text-gray-400">
        <button onclick="exportData()" class="hover:text-gray-900 transition-colors">Export JSON</button>
        <label class="cursor-pointer hover:text-gray-900 transition-colors">
            Import JSON
            <input type="file" id="importInput" class="hidden" accept=".json">
        </label>
    </div>
    </div>
        </aside>

        <main class="w-[70%] flex flex-col h-full relative">
    <div class="p-8 flex flex-col h-full">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-sm font-medium tracking-widest uppercase text-gray-400">Meeting Minutes</h2>
            <div class="flex items-center gap-4">
                <button onclick="togglePreview()" id="previewBtn" class="text-[10px] border border-gray-200 px-3 py-1 rounded-full hover:bg-gray-50 transition-all uppercase tracking-widest">Preview</button>
                <span id="saveStatus" class="text-[10px] text-gray-300 italic uppercase">Auto-saving...</span>
                <button onclick="askGemini()" class="text-[10px] bg-black text-white px-3 py-1 rounded-full hover:bg-gray-800 transition-all uppercase tracking-widest">AI Summary</button>
            </div>
            
        </div>

        <textarea id="meetingNotes" 
            class="flex-1 w-full resize-none bg-transparent text-lg leading-relaxed text-gray-700 focus:outline-none placeholder-gray-200" 
            placeholder="åœ¨æ­¤å¼€å§‹è®°å½•..."></textarea>
            
        <div id="markdownPreview" 
            class="hidden flex-1 w-full overflow-y-auto prose prose-sm prose-slate max-w-none text-gray-700">
        </div>

        <div id="aiModal" class="hidden fixed inset-0 bg-black/20 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl p-8 max-h-[80vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-sm font-bold uppercase tracking-widest">AI Analysis</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-black">âœ•</button>
        </div>
        <div id="aiContent" class="text-sm leading-relaxed text-gray-600 prose">
            æ­£åœ¨æ€è€ƒä¸­...
        </div>
    </div>
</div>
        
    </div>
    
</main>

    </div>
    <script>
        // --- 1. çŠ¶æ€åˆå§‹åŒ– ---
        // --- 1. çŠ¶æ€ç®¡ç†å‡çº§ ---
let currentDate = new Array(); // å ä½
const datePicker = document.getElementById('datePicker');

// è·å–å½“å‰é€‰ä¸­çš„æ—¥æœŸå­—ç¬¦ä¸² (YYYY-MM-DD)
const getDS = () => datePicker.value;

let state = {
    tasks: [],
    notes: ""
};
    // --- 2. DOM å…ƒç´ è·å– ---
    const taskInput = document.getElementById('taskInput');
    const taskList = document.getElementById('taskList');
    const notesArea = document.getElementById('meetingNotes');
    const saveStatus = document.getElementById('saveStatus');

    // --- 3. æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---

    // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
    const renderTasks = () => {
        taskList.innerHTML = state.tasks.map((task, index) => `
            <li class="flex items-center group animate-in fade-in duration-300">
                <div onclick="removeTask(${index})" 
                    class="w-4 h-4 border border-gray-300 rounded-sm mr-3 group-hover:border-red-400 group-hover:bg-red-50 cursor-pointer transition-all">
                </div>
                <span class="text-sm text-gray-600">${task}</span>
            </li>
        `).join('');
        localStorage.setItem('min_tasks', JSON.stringify(state.tasks));
    };

    // æ·»åŠ ä»»åŠ¡
    const addTask = (content) => {
        if (!content.trim()) return;
        state.tasks.push(content.trim());
        taskInput.value = '';
        renderTasks();
        saveDataByDate();
    };

    // åˆ é™¤ä»»åŠ¡
    const removeTask = (index) => {
        state.tasks.splice(index, 1);
        renderTasks();
        saveDataByDate();
    };

    // ä¿å­˜ç¬”è®° (å¸¦çŠ¶æ€æç¤º)
    // --- 2. æ ¸å¿ƒï¼šåŸºäºæ—¥æœŸçš„åŠ è½½ä¸ä¿å­˜ ---

const loadDataByDate = () => {
    const ds = getDS();
    state.tasks = JSON.parse(localStorage.getItem(`min_tasks_${ds}`)) || [];
    state.notes = localStorage.getItem(`min_notes_${ds}`) || "";
    
    // åŒæ­¥ UI
    notesArea.value = state.notes;
    renderTasks();
};

const saveDataByDate = () => {
    const ds = getDS();
    localStorage.setItem(`min_tasks_${ds}`, JSON.stringify(state.tasks));
    localStorage.setItem(`min_notes_${ds}`, state.notes);
    
    saveStatus.innerText = "Saved to " + ds;
    setTimeout(() => { saveStatus.innerText = "Auto-saving..."; }, 2000);
};

// --- 3. å¢å¼ºåçš„ saveNotes (æ•´åˆä»»åŠ¡æå–) ---
const saveNotes = () => {
    state.notes = notesArea.value;
    
    // æ­£åˆ™æå–é€»è¾‘ (ä¿æŒä¸å˜)
    const taskRegex = /^- \[ \] (.+)$/gm;
    let match;
    let hasNewTask = false;

    while ((match = taskRegex.exec(state.notes)) !== null) {
        const newTaskContent = match[1].trim();
        if (newTaskContent && !state.tasks.includes(newTaskContent)) {
            state.tasks.push(newTaskContent);
            hasNewTask = true;
        }
    }


    // 3. æ•°æ®æŒä¹…åŒ–
    localStorage.setItem('min_notes', state.notes);
    
    // 4. è§†è§‰åé¦ˆï¼šå¦‚æœæå–äº†æ–°ä»»åŠ¡ï¼Œåˆ™åˆ·æ–°åˆ—è¡¨å¹¶ä¿å­˜
    saveDataByDate();
    if (hasNewTask) {
        renderTasks();
        localStorage.setItem('min_tasks', JSON.stringify(state.tasks));
    }

    // æ›´æ–°çŠ¶æ€æç¤º
    saveStatus.innerText = "Saved & Synced";
    setTimeout(() => { saveStatus.innerText = "Auto-saving..."; }, 2000);
};


// å»ºè®®åŒæ­¥æ›´æ–° CSSï¼šä¸ºæ–°æ·»åŠ çš„ä»»åŠ¡å¢åŠ ä¸€ä¸ªç®€å•çš„é—ªçƒåŠ¨ç”»
const style = document.createElement('style');
style.innerHTML = `
    @keyframes highlight {
        0% { background-color: transparent; }
        50% { background-color: #fef08a; } /* æµ…é»„è‰² */
        100% { background-color: transparent; }
    }
    .animate-new-task { animation: highlight 2s ease-out; }
`;
document.head.appendChild(style);

    // --- 4. é˜²æŠ–é€»è¾‘ (Debounce) ---
    const debounce = (fn, delay) => {
        let timer;
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), delay);
        };
    };

    const debouncedSave = debounce(saveNotes, 500);

    // --- 5. äº‹ä»¶ç›‘å¬ ---

    // ä»»åŠ¡è¾“å…¥æ¡†å›è½¦
    taskInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addTask(e.target.value);
    });

    // ç¬”è®°è¾“å…¥ç›‘å¬
    notesArea.addEventListener('input', () => {
        saveStatus.innerText = "Typing...";
        debouncedSave();
    });

    // --- 6. é¡µé¢åŠ è½½åˆå§‹åŒ– ---
    window.addEventListener('DOMContentLoaded', () => {
        notesArea.value = state.notes;
        renderTasks();
    });
    // --- äº‹ä»¶ç›‘å¬å‡çº§ ---
    // æ—¥æœŸåˆ‡æ¢ç›‘å¬
datePicker.addEventListener('change', () => {
    // åˆ‡æ¢å‰å¯ä»¥å…ˆæ‰§è¡Œä¸€æ¬¡ä¿å­˜ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
    saveDataByDate(); 
    loadDataByDate();
});

// åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨ä¸ºä»Šå¤©
window.addEventListener('DOMContentLoaded', () => {
    const today = new Date().toISOString().split('T')[0];
    datePicker.value = today;
    loadDataByDate();
});
  // --- æ•°æ®å¤‡ä»½ä¸è¿˜åŸåŠŸèƒ½ ---

// 1. å¯¼å‡ºå‡½æ•°ï¼šæ‰“åŒ…æ‰€æœ‰ä»¥ "min_" å¼€å¤´çš„æœ¬åœ°æ•°æ®
const exportData = () => {
    const backupData = {};
    // éå†æ‰€æœ‰æ•°æ®ï¼ŒåªæŠ“å–æˆ‘ä»¬åº”ç”¨äº§ç”Ÿçš„ key
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('min_')) {
            backupData[key] = localStorage.getItem(key);
        }
    }

    const dataStr = JSON.stringify(backupData, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    
    // åˆ›å»ºè™šæ‹Ÿé“¾æ¥å¹¶è§¦å‘ä¸‹è½½
    const link = document.createElement("a");
    link.href = url;
    link.download = `sync_backup_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
};

// 2. å¯¼å…¥å‡½æ•°ï¼šè¯»å– JSON å¹¶å­˜å…¥ LocalStorage
document.getElementById('importInput').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
        try {
            const importedData = JSON.parse(event.target.result);
            
            // ç¡®è®¤è¦†ç›–æç¤º
            if (confirm("å¯¼å…¥å°†åˆå¹¶æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ")) {
                Object.keys(importedData).forEach(key => {
                    if (key.startsWith('min_')) {
                        localStorage.setItem(key, importedData[key]);
                    }
                });
                alert("å¯¼å…¥æˆåŠŸï¼é¡µé¢å³å°†åˆ·æ–°ã€‚");
                location.reload(); // åˆ·æ–°ä»¥åŠ è½½æ–°æ•°æ®
            }
        } catch (err) {
            alert("æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿æ˜¯æœ‰æ•ˆçš„ JSON æ–‡ä»¶ã€‚");
        }
    };
    reader.readAsText(file);
});
const askGemini = async () => {
    // 1. è·å–æˆ–è¦æ±‚è¾“å…¥ API Key
    let apiKey = localStorage.getItem('gemini_api_key');
    if (!apiKey) {
        apiKey = prompt("è¯·è¾“å…¥æ‚¨çš„ Gemini API Key (ä»…ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨):");
        if (apiKey) localStorage.setItem('gemini_api_key', apiKey);
        else return;
    }

    // 2. æ˜¾ç¤ºå¼¹çª—
    const modal = document.getElementById('aiModal');
    const content = document.getElementById('aiContent');
    modal.classList.remove('hidden');
    content.innerText = "æ­£åœ¨è°ƒåŠ¨ AI è¿›è¡Œæ·±åº¦åˆ†æ...";

    // 3. æ„å»ºæ·±åº¦æç¤ºè¯ (æ•´åˆäº†ä½ åˆšæ‰çš„ç²¾å¦™é€»è¾‘)
    const promptText = `
        ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é«˜çº§ç§˜ä¹¦å’Œé¡¹ç›®ç®¡ç†ä¸“å®¶ã€‚
        è¯·æ ¹æ®ä»¥ä¸‹æ—¥æœŸã€å¾…åŠäº‹é¡¹å’Œä¼šè®®ç¬”è®°è¿›è¡Œç»¼åˆåˆ†æã€‚
        
        æ—¥æœŸï¼š${datePicker.value}
        å½“å‰å¾…åŠï¼š${JSON.stringify(state.tasks)}
        ä¼šè®®ç¬”è®°ï¼š${state.notes}
        
        è¯·è¾“å‡ºä»¥ä¸‹æ ¼å¼ï¼š
        ### ğŸ“Œ æ ¸å¿ƒæ‘˜è¦
        (ç®€è¦è¯´æ˜ä¼šè®®é‡ç‚¹)
        
        ### âš¡ æ½œåœ¨é£é™©
        (è¯·è¯†åˆ«ç¬”è®°ä¸­ä»»ä½•éšå«çš„èµ„æºå†²çªã€æˆªæ­¢æ—¥æœŸå‹åŠ›æˆ–æœªæ˜ç¡®çš„è´£ä»»å½’å±)
        
        ### ğŸ’¡ æ”¹è¿›å»ºè®®
        (åŸºäºå½“å‰ä»»åŠ¡å’Œç¬”è®°ï¼Œç»™å‡ºä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨å»ºè®®)
    `;

    // 4. è°ƒç”¨ Gemini API
    try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: promptText }] }]
            })
        });

        const data = await response.json();
        const aiResponse = data.candidates[0].content.parts[0].text;
        
        // æ¸²æŸ“ç»“æœ (è¿™é‡Œç®€å•å¤„ç†ï¼Œå®é™…å¯ç”¨ markdown è§£æåº“)
        content.innerText = aiResponse;
    } catch (error) {
        content.innerText = "è°ƒç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Key æˆ–ç½‘ç»œçŠ¶å†µã€‚";
    }
};

const closeModal = () => {
    document.getElementById('aiModal').classList.add('hidden');
};
let isPreview = false;

const togglePreview = () => {
    const textarea = document.getElementById('meetingNotes');
    const previewDiv = document.getElementById('markdownPreview');
    const btn = document.getElementById('previewBtn');

    isPreview = !isPreview;

    if (isPreview) {
        // å°† Markdown è½¬æ¢ä¸º HTML å¹¶æ˜¾ç¤º
        previewDiv.innerHTML = marked.parse(textarea.value);
        textarea.classList.add('hidden');
        previewDiv.classList.remove('hidden');
        btn.innerText = "Edit";
        btn.classList.add('bg-gray-100');
    } else {
        textarea.classList.remove('hidden');
        previewDiv.classList.add('hidden');
        btn.innerText = "Preview";
        btn.classList.remove('bg-gray-100');
    }
};

// æ ·å¼å¾®è°ƒï¼šä¸ºäº†è®© Markdown æ¸²æŸ“å¥½çœ‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç‚¹ CSS
const markdownStyle = document.createElement('style');
markdownStyle.innerHTML = `
    #markdownPreview h1 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
    #markdownPreview h2 { font-size: 1.25rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.75rem; }
    #markdownPreview ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
    #markdownPreview p { margin-bottom: 1rem; line-height: 1.8; }
    #markdownPreview code { background: #f3f4f6; padding: 0.2rem 0.4rem; rounded: 0.25rem; font-size: 0.875em; }
    #markdownPreview blockquote { border-left: 4px solid #e5e7eb; padding-left: 1rem; italic; color: #6b7280; }
`;
document.head.appendChild(markdownStyle);
    </script>     
</body>
</html>